{% extends "base.html" %}
{% load user_annotations tagging_tags smartif user_projects threadedcomments_tags %}

<title> {% block title %}
{% if is_space_owner %}
    My Projects > 
    {% if project.title %}{{project.title}}{% else %}New project{% endif %}
{% else %}
    Class Analysis > 
    {{space_owner.username}}'s Projects > 
    {% if project.title %}{{project.title}}{% else %}New project{% endif %}
{% endif %}
{% endblock %}</title>

{% block css %}
<link rel="stylesheet" href="/site_media/css/project.css" />  
{% endblock %}

{% block js %}
  <script type="text/javascript" src="/site_media/js/mochikit/MochiKit/MochiKit.js"></script>
  <script type="text/javascript" src="/site_media/js/hs.js"></script>
  <script type="text/javascript" src="/site_media/js/tablesort.js"></script>
  <script type="text/javascript" src="/site_media/js/vital3/assetwindow.js"></script>

  <!--All the annotation javascript/css -->
  {% include "djangosherd/annotator_resources.html" %}

  <script type="text/javascript">        
    DjangoSherd_Project_Config(/*no_open_from_hash=*/ true);           
  </script>
  <!--END for showing Annotations -->

  <script type="text/javascript" src="/site_media/js/project/project.js"></script>
  <!--script type="text/javascript" src="/site_media/js/project/editor.js"></script-->

{% endblock %}

{% block content %}
  {{ block.super }}


  
<h1>{% if is_space_owner %}
    My Projects > 
    Editing Project: {% if project.title %}{{project.title}}{% else %}New project{% endif %}
{% else %}
    Class Analysis > 
    {{space_owner.username}}'s Projects > >
    Editing Project: {% if project.title %}{{project.title}}{% else %}New project{% endif %}
{% endif %}</h1><br />

 <form class="yui-skin-sam" name="editproject" method="POST" action=".">

      <div id="project_heading">
	
<div id="title_area"><strong>Project Title: </strong>{{projectform.title}}</div>
      
<div id="project_participants">
	  <b>{{projectform.participants.label_tag}}:</b>
	  	<span id="participants_chosen"
		      >{%for part in project.participants.all %}{%if not forloop.first%},{%endif%}
		    {{part.username}}{%endfor%}</span>
	  	<a class="hs-control hs-control-show plist" href="#participant_list">Edit</a>
	 <div id="participant_list" class="hs-init-hide hs-hide"> 
	 <p>{{projectform.participants.help_text }}</p>
	  <br />
	  {{projectform.participants}} <a id="participants_close" class="hs-control hs-control-show plist float" href="#participant_list" >Close</a></div>
	  <div id="participant_update" style="display:none">Save the project to save new collaborator list.</div>
	</div></div><br />
<div id="asset_browse_col" class="asset-table">
  <h2>Your Saved Items</h2>
  <div id="materials">
    {% include "projects/asset_table.html" %}
  </div>
</div>
  <div class="essay-space">
    <!-- IMPORTANT!!! yui-skin-sam is necessary for YUI editor -->
   
      
      <p>
	<h2>Project Content</h2>
	<div id="essaybox" class="essaytextarea">
	  <script type="text/javascript" src="/site_media/js/sherdjs/lib/tiny_mce3/jscripts/tiny_mce/tiny_mce.js"></script>
	  <script type="text/javascript" src="/site_media/js/vital3/tiny_mce_init3.js"></script>
	  <textarea id="project-content" tabindex="0" name="body" 
		    mce_editable="true">{{project.body|safe}}</textarea>
	  {#{{projectform.body}}#}
	  <div id="project-template" style="display:none;"></div>
	  <script type="text/javascript">
	    if ($("project-content").innerHTML == "") {
	      if ($("project-template") != null) {
	        $("project-content").innerHTML = $("project-template").innerHTML;
	      }
	    }
	  </script>
	</div>
	
      </p>
      
      
     <br /> 
      <input type="submit" name="submit" value="Save draft"/>
      <input type="submit" name="submit" value="Preview"/>
      <input type="submit" name="submit" value="Submit"/>
   
     </form>
   </div>


      <hr/>
      <div id="threadedcomments">
   {%comment %}
        Your comment on this project:
        {% get_comment_form for project as eddie_comment_form %}
        <form method="POST" action="/comments/post/">
            <ul>
                {{ eddie_comment_form.as_ul }}
                <li><input type="submit" value="Submit Comment" /></li>
            </ul>
        </form>
      
        <hr/>
           
        Leave a new comment on this project:
        {% get_comment_form for project as eddie_new_comment_form %}
        <form method="POST" action="/comments/post/">
            <ul>
                {{ eddie_new_comment_form.as_ul }}
                <li><input type="submit" value="Submit Comment" /></li>
            </ul>
        </form>
      
        <hr/>
        
        Other people's comments on this project:
   {%endcomment %}
        
        
        {% get_comment_list for project as comment_list %}
            <h3>Comments on This Project:</h3>
            {% for current_comment in comment_list|fill_tree|annotate_tree %}
            <!--
                    open is: {{current_comment.open}}<br />
                    close is: {{current_comment.open}}<br />
                    last is: {{current_comment.last}}<br />
                    parent_id: {{current_comment.parent_id}}<br />
                    id: {{current_comment.id}}<br />
            -->
                <!-- starting comment: >{{ current_comment.id }}-->
               
                <!-- Start list management -->
                {% ifchanged current_comment.parent_id %}
                    <!-- about to start a new level of indentation: -->
                {% else %}
                    <!-- same indent level: -->
                    </li>
                {% endifchanged %}
                {% if not current_comment.open and not current_comment.close %}
                    <!-- not open and not closed-->
                    </li>
                {% endif %}
                {% if current_comment.open %}
                    <ul >
                {% endif %}<!-- test 3 -->
                
                
                <li{% if current_comment.last %} class="last"{% endif %}><!-- new child node -->
                <a href="{{ current_comment.website }}">{{ current_comment.name }}</a>
                said  ( #{{ current_comment.id }}):
                {{current_comment.comment|safe}}
                <!-- Start comment on this comment -->
                    <div> Respond to comment {{ current_comment.id }}:</div>
                    {% get_comment_form for project as current_comment_form with current_comment.id %}
                    
                    
                    <form method="POST" action="/comments/post/" class="threaded_comments_form">
                        <ul>
                            {{ current_comment_form.as_ul }}
                            <li><input type="submit" value="Submit Comment" /></li>
                        </ul>
                    </form>
                <!-- End comment on this comment -->
                
                
                {% if current_comment.added_path %} ADDED {% endif %}<!-- test 4 -->
                {% for close in current_comment.close %}
                   <!-- closing children --></li>
                    </ul>
                {% endfor %}
                <!-- End list management -->
            {% endfor %}
                    
        {% comment %}                                       
                        Then you can use the template tags supplied by the application. The
                        templatetags have the same syntax and semantics as the built-in comments
                        application with a few exceptions:

                            * ``get_comment_form`` and ``render_comment_form`` take extra optional
                              arguments specifying the parent comment (the comment we wish to respond
                              to)::
                                
                                {% get_comment_form for [object] as [varname] with [parent_id] %}
                                {% get_comment_form for [app].[model] [object_id] as [varname] with [parent_id] %}
                                {% render_comment_form for [object] with [parent_id] %}
                                {% render_comment_form for [app].[model] [object_id] with [parent_id] %}

                            * ``get_comment_list`` takes extra optional argument which can be one of:
                                
                                    * ``flat`` specifies that we want the comments returned sorted from
                                      newest to oldest ignoring the threading information

                                    * ``root_only`` also results in the resulting queryset being ordered
                                      from newest to oldest but will also omit comments that reply to
                                      other comments, thus giving you only the *root* comments.

                        Two additional template filters are provided to help with rendering the comments in proper tree form:

                            * ``annotate_tree`` will define set of additional attributes on comments:
                                
                                * ``open`` is set to ``True`` if the comment starts new level of depth.
                                
                                * ``close`` is set to a list of depth levels that should be closed after this comment.

                                * ``last`` is set to ``True`` if the comment is last on it's level of depth.
                              

                            * ``fill_tree`` prefixes a comment list with a path from root comment to the
                              first comment in the list. This was designed to help with paginating
                              threaded comments since it basically adds context to the first comment
                              both in terms of user experience (users see what the first comment on
                              page replies to) and HTML designers (the tree doesn't start half way
                              down and ``annotate_tree`` supplies correct information). The comments that
                              were added by this filter has ``added_path`` property set to ``True``.

                        The common use case for rendering comments as a tree would look something like::

                            {% for comment in comment_list|fill_tree|annotate_tree %}
                                ...
                            {% endfor %}
        {% endcomment %}
        
      </div>

{% endblock %}
