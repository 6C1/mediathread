{% extends "base.html" %}
{% load smartif coursetags %}
{% block title %}"{{asset.title|striptags|safe}}"{% endblock %}
{% block css %}
  {{ block.super }}
  <link rel="stylesheet" media="screen" href="/site_media/css/tabber.css" />

{% endblock %}

{% block js %}
  <script type="text/javascript" src="/site_media/js/tabber.js"></script>
  <script type="text/javascript" src="/site_media/js/hs.js?v1"></script>
  <!--All the annotation javascript/css -->
  {% include "djangosherd/annotator_resources.html" %}

  <script type="text/javascript" src="/site_media/js/mustache/mustache.js"></script>
  <script type="text/javascript" src="/site_media/js/assetmgr/asset.js?v1"></script>
  <script type="text/javascript">
    DjangoSherd_Asset_Config();    
    {% if not mock %}
    AnnotationList.init({ 
         "asset_id":{{asset.id}}
       {% if global_annotation %}
         ,"global_annotation_id":{{global_annotation.id}}
       {% endif %}       
       {% if annotation %}
         ,"annotation_id":{{annotation.id}}
       {% endif %}       
    });
    {% endif %}{# not mock #}    
  </script>

{% endblock %}

{% block extra_body_class %}{% if mock %}preview{% endif %} old-assetwindow{% endblock %}

{% block content %}
  {{ block.super }}
<h1>
  {% if annotation %}<a href="{{asset.get_absolute_url}}">{% endif %} 

  {{asset.title|striptags|safe}}

  {% if annotation %}</a>{% endif %} 
</h1> 
{%if asset.html_source.url %}
  <a class="fullrecord_button" href="{{asset.html_source.url}}">Item source</a>
{%endif%}
  
{% if mock %}
<p>Add annotations to save this item to Your Analysis.</p>
{% endif %}<!-- if mock-->

<div id="workspace">
    <div class="asset-view asset-view-big">
        <div id="asset_details_col"> <!-- right column -->
            <div class="tabber">
                 
                 <div class="indexcard tabbertab tabbertabdefault" title="Selections">
                    <!--  @todo: resolve chicken/egg issue with clipform. its 1st setstate relies on this code snippet being here -->
                    <div id="asset-details-annotations">
                        {% if annotation %}
                            <div id="original-annotation" class="annotation-data" 
                                 data-begin="{{annotation.range1}}" 
                                 data-end="{{annotation.range2}}" 
                                 data-annotation='{{annotation.annotation_data|default_if_none:"{}"|escape}}'>
                            </div>
                        {% endif %}
                    </div> <!--  Replaced by Mustache :{ --> 
                </div> <!-- end Annotations tab -->
                
                <div class="tabbertab" title="Item Details">
                    <div class="asset-info">
                        {% if asset.id and request.user.is_staff %}
                          <a href="{%url admin:assetmgr_asset_change asset.id %}">Manage</a>
                        {% endif %}
                        {% for name, values in asset.metadata.items %}
                        <dl>
                          <dt><h2 class="metadata-title">{{name}}</h2></dt>
                              {# is values a list or string? #}
                              {% if not values.lower %}
                                {% for v in values %}
                                <dd id="metadata-{{name}}">
                                  {% if "http" in v %}
                                    <a href="{{v}}">{{v}}</a>
                                  {% else %}
                                    {{v}}
                                  {% endif %}
                                </dd>
                                {% endfor %}
                              {% else %}
                          <dd id="metadata-{{name}}">{{values}}</dd>
                              {% endif %}
                        </dl>
                        {% endfor %}
                    </div>
                </div> <!-- end Info tab -->

                {% if not mock %}
                    <div class="tabbertab indexcard" title="References">
                        <h2>Class Tags</h2>

                        <div id="classtags" class="sub-control">
                            {% for tag in tags %}
                            <span class="size{{tag.font_size}}">
                              <a href="{% url asset-container %}?tag={{tag.name}}">
                              {{tag.name}} ({{tag.count}})</a>
                            </span>&nbsp;
                            {% endfor %}
                        </div><!-- end id="classtags" -->
                        <br /><br />
    
                        <h2><a href="#discussion"></a>Project and Discussion References</h2>
                        <div id="discussions" class="sub-control">
                            {%if discussions%}
                            <ul class="clumper">
                                  {%for clump in discussions%}
                                     {%include "projects/clump.html" %}
                                  {%endfor%}
                                </ul>
                            {%endif%}{#end if discussions #}
                        </div><!--end id="discussions" -->

                        <div id="discussion" class="sub-control">
                            {% load comments %}
                                {# {% if comments.10 %}  {% render_comment_form for asset %}{% endif %} #}
                            {% for comment in comments %}
                                <p>
                                <strong>{% public_name for comment.user %}</strong> at {{comment.submit_date|date}}
                                <br/>
                                {{comment.comment}}
                                </p>
                            {% endfor %}
                        </div>
                    </div><!-- title="Class Activity" -->
                {% endif %}<!--end if not mock-->
                

            </div> <!-- end tabber -->
            
        </div><!-- end right_col -->
        
        <div class="asset-links">
          <ul>
            {% with asset.source_set.all as assets_to_link %}
              {% include "assetmgr/asset_links.html" %}
            {% endwith %}
          </ul>
        </div>
        <div class="asset-object">
            <div class="clipbox"><!-- width changes here too if video size changes -->
                <div id="asset-display" class="asset-display"></div>
                <div id="clipstrip-display"></div>
            </div><!--class="clipbox"-->
        </div><!--class="asset-object"-->
    </div><!--class="asset-view"-->
</div><!--id="workspace"-->

{% endblock %}
